---
title: "バッチで外部プログラムを呼び出すと文字化けするときの対処"
date: 2020-11-01T14:43:40+09:00
draft: false
---

## 文字化けしていたのが気になっていた

バッチファイルから外部CUIプログラムを呼び出す際、内部文字コードがUTF-8のものの場合、文字化けが発生することがあります。

それなら、バッチファイルの文字コードをUTF-8にすれば解決するのではと思いましたが、逆にバッチファイルが文字化けしてしまいました。
日本語環境のWindowsで動かすバッチファイルは、原則Shift JISであるべきだからのようです[^1]。

[^1]: [バッチファイルの文字コードは？: Windows Script Programming](http://scripting.cocolog-nifty.com/blog/2008/12/post-38f8.html)




## chcpで文字コードの指定ができるようだ

`chcp` というコマンドを使うことで、文字コードの指定ができるようです。
試しに、外部プログラムを呼び出す直線直後をUTF-8、それ以外をShift JISにするようにしてみました…。

```bash:example_inc_ja.bat
chcp 932
echo   ========================================================
echo                        テストプログラム v1.0
:start
echo   ========================================================
echo.
set /P pause=":   続行するには何かキーを押してください："
chcp 65001
ExampleCuiProgram
chcp 932
echo プログラムが完了しました。
set /P pause=":   終了するには何かキーを押してください："
```

`chcp 932` がShift JIS、 `chcp 65001` がUTF-8に対応します。その他の文字コードや、コマンドの使い方については、[文字コードの設定(CHCP) | コマンドプロンプトの使い方](https://www.adminweb.jp/command/display/index5.html) に載っていますので、参考にしてください。

動作として、linuxの`reset`のような挙動で動きます。  
「テストプログラム」と、キーを押下させる指示を表示したあと、外部のCUIプログラムを呼び出すわけですが、この行が走ったあと、一旦出力がリセットされます。
CUIプログラムの処理が終わったら、また出力がリセットされて、「完了しました」表示がされます。