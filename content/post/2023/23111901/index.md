---
title: "OneDriveのファイルをgitで管理するときはローカルにファイルをDLしないとエラーになる"
date: 2023-11-19T15:13:50+09:00
draft: false
---

今までgitで管理してこなかったけれど、これから管理したいのでinstall commitしようとした。
が、commitに追加しようとしても反応がない。しばらくして以下のようなエラーが出て結局コミットが作成できなかった。

```
fatal: Unable to create '…/.git/index.lock': File exists.
```

index.lock というファイルがすでにあるのでコミットが作れないよ、というエラー。
つまり、すでにプロセスが走っていてそれと重複して処理されておかしくならないようにロックされていますよ、ということである。

---

環境をおさらいしておくと、以下のような感じとなっている。

- PC: MacBook Air (M2, 2022)
- エディタ: VSCode
- 管理対象のファイルはOneDrive上にある。 [ファイルオンデマンド機能](https://support.microsoft.com/ja-jp/office/mac-%E7%94%A8-onedrive-%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB-%E3%82%AA%E3%83%B3%E3%83%87%E3%83%9E%E3%83%B3%E3%83%89%E3%81%A7%E3%83%87%E3%82%A3%E3%82%B9%E3%82%AF%E9%A0%98%E5%9F%9F%E3%82%92%E7%AF%80%E7%B4%84%E3%81%99%E3%82%8B-529f6d53-e572-4922-a585-e7a318c135f0) によりローカルにファイルはなかった

「ファイルオンデマンド機能」が今回の原因。

コミットするにあたって、gitのプロセスは当然それぞれのファイルを読み込む必要がある。
ファイルオンデマンド機能は、使うときだけファイルをローカルに落とす機能。
本来はファイルを開けば勝手にクラウドからダウンロードしてくれるのだが、コミット対象のファイル数が多かったのか、ダウンロード処理が走っていないようであった。

そんなこんなで、ファイルとしてローカルにないけれども、あるように見せかけるので、うまく動かなかったというわけのようである。
(「オンライン専用ファイル」という状態のままだったらしい。)

ローカルにファイルを落とすには、Finderのファイル名の横にある「クラウドのマーク」を押下すればOK。

![DL button](dl-button.webp)

これで問題なくコミットすることができた。めでたし。